var map = L.map('map');

L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

/*L.tileLayer.provider('MapBox', {
    id: 'mapbox.satellite',
    accessToken: 'pk.eyJ1IjoibWFyY28tZGlzdHJ1dHRpIiwiYSI6ImNrNm9mc3E2eDBldjQzcm05d3lndDIzM3QifQ.XMxAYzSIzCVLSySDdCwa_w'
}).addTo(map);*/

var pathObjects = [{"serial": -1, "coords": [45.5069182, 9.2684501]}, {"serial": "4318007648", "coords": [45.48614495446011, 9.233467442287974]}, {"serial": "4318007503", "coords": [45.48605976430546, 9.233247795726925]}, {"serial": "3718006263", "coords": [45.485742213188, 9.233261379787448]}, {"serial": "3618004310", "coords": [45.483797340164394, 9.233175016819699]}, {"serial": "3618004294", "coords": [45.48318486365244, 9.231379196920898]}, {"serial": "3618004287", "coords": [45.4825199, 9.230739999999999]}, {"serial": "4118006643", "coords": [45.4829777, 9.2317355]}, {"serial": "3618004289", "coords": [45.4827783, 9.2303836]}, {"serial": "4318007540", "coords": [45.48383171306672, 9.229989783974474]}, {"serial": "4318007710", "coords": [45.48478074019822, 9.230000050847368]}, {"serial": "219011857", "coords": [45.485913000000004, 9.2265644]}, {"serial": "219011872", "coords": [45.484373, 9.2261909]}, {"serial": "4318007441", "coords": [45.484449299999994, 9.2254983]}, {"serial": "4318007465", "coords": [45.485158899999995, 9.2248388]}, {"serial": "219011862", "coords": [45.484303999999995, 9.222647300000002]}, {"serial": "219011890", "coords": [45.486063200000004, 9.2224413]}, {"serial": "5018009437", "coords": [45.48603526902311, 9.221096490135094]}, {"serial": "5018009436", "coords": [45.48596370310714, 9.221214380156766]}, {"serial": "5018009439", "coords": [45.48431398643032, 9.220614665569316]}, {"serial": "219011867", "coords": [45.4843125, 9.222164900000001]}, {"serial": "4718009326", "coords": [45.484206180300035, 9.223603192126689]}, {"serial": "4718009284", "coords": [45.48390145392643, 9.22366623693415]}, {"serial": "4718009298", "coords": [45.481486672129975, 9.223610591181341]}, {"serial": "4718009321", "coords": [45.480873204006535, 9.223610435308046]}, {"serial": "5018010114", "coords": [45.480514, 9.223002699999999]}, {"serial": "4118006898", "coords": [45.4806451, 9.224757499999999]}, {"serial": "4118006798", "coords": [45.4806451, 9.224757499999999]}, {"serial": "119010130", "coords": [45.48071229999999, 9.225236500000001]}, {"serial": "3618004298", "coords": [45.481114399999996, 9.2256273]}, {"serial": "4318007627", "coords": [45.480976, 9.2250856]}, {"serial": "4318007609", "coords": [45.4810347, 9.2252524]}, {"serial": "4318007489", "coords": [45.4816397, 9.225097900000002]}, {"serial": "4318007438", "coords": [45.481976, 9.225077699999998]}, {"serial": "219011854", "coords": [45.4843849, 9.225000900000001]}, {"serial": "5018010100", "coords": [45.48019419646136, 9.226450440974304]}, {"serial": "4318007440", "coords": [45.48139860000001, 9.2265605]}, {"serial": "3618004293", "coords": [45.480756372362, 9.224731310463195]}, {"serial": "219011739", "coords": [45.47925663343508, 9.221337982248087]}, {"serial": "219011731", "coords": [45.48031851875677, 9.221288372662913]}, {"serial": "219011746", "coords": [45.479650519878476, 9.223554891427057]}, {"serial": "4118006624", "coords": [45.47855, 9.223935899999999]}, {"serial": "4118006785", "coords": [45.479194228360605, 9.225654532388038]}, {"serial": "1419015180", "coords": [45.47825763323742, 9.2250134199096]}, {"serial": "1219014379", "coords": [45.4782223633751, 9.22572137200052]}, {"serial": "1419015237", "coords": [45.478214225767225, 9.225864152498618]}, {"serial": "1419015175", "coords": [45.47818904739633, 9.224832170602326]}, {"serial": "4118006936", "coords": [45.478089443279025, 9.225647053039554]}, {"serial": "1419015232", "coords": [45.477989824906686, 9.22573871093607]}, {"serial": "4118006931", "coords": [45.477981931182136, 9.225646874162292]}, {"serial": "1419015148", "coords": [45.47783195089447, 9.225260660590381]}, {"serial": "4118006952", "coords": [45.47773865667203, 9.225635011999655]}, {"serial": "4118006961", "coords": [45.477650777419385, 9.225615704244547]}, {"serial": "1419015250", "coords": [45.4778011804085, 9.226876453731393]}, {"serial": "1419015149", "coords": [45.47788924729082, 9.226931214826324]}, {"serial": "1419015278", "coords": [45.47827318539894, 9.226816477201057]}, {"serial": "4118006609", "coords": [45.47863029970482, 9.225639172575713]}, {"serial": "4118006593", "coords": [45.479097642021856, 9.225761682125947]}, {"serial": "1419015272", "coords": [45.47908662561681, 9.226270092528694]}, {"serial": "1419015270", "coords": [45.479163068737385, 9.226523145888336]}, {"serial": "1419015235", "coords": [45.47865604244682, 9.22653998514886]}, {"serial": "1419015261", "coords": [45.47913917548171, 9.22657088649612]}, {"serial": "1419015251", "coords": [45.47901825704892, 9.226586724428671]}, {"serial": "3618004315", "coords": [45.480777818468454, 9.229824643846996]}, {"serial": "3618004324", "coords": [45.48143239826018, 9.229741153633881]}, {"serial": "3618004319", "coords": [45.4821777, 9.2300649]}, {"serial": "3618004316", "coords": [45.482569299999994, 9.2342079]}, {"serial": "3618004301", "coords": [45.481456099999996, 9.2342674]}, {"serial": "219011045", "coords": [45.4804559, 9.2342485]}, {"serial": "5018009670", "coords": [45.47939817434774, 9.231374457199536]}, {"serial": "219011054", "coords": [45.47849235277401, 9.229899278088167]}, {"serial": "219011025", "coords": [45.47847218774467, 9.230077892019947]}, {"serial": "4318007377", "coords": [45.4769667697792, 9.228015118309829]}, {"serial": "4318007657", "coords": [45.476849798994415, 9.22725311969657]}, {"serial": "4118006937", "coords": [45.47694050000001, 9.2264537]}, {"serial": "1419015169", "coords": [45.47770409923299, 9.22431474831285]}, {"serial": "4118006939", "coords": [45.478019, 9.223985699999998]}, {"serial": "1419015135", "coords": [45.478041573049936, 9.224341504847756]}, {"serial": "1419015161", "coords": [45.47811971016775, 9.22422671557274]}, {"serial": "1419015163", "coords": [45.478295254824154, 9.224464818560818]}, {"serial": "1419015147", "coords": [45.478504432895384, 9.224036417424259]}, {"serial": "219011693", "coords": [45.47570402522745, 9.223391568235913]}, {"serial": "5018010112", "coords": [45.475239, 9.2243326]}, {"serial": "5018010101", "coords": [45.4753626, 9.224805300000002]}, {"serial": "5018010102", "coords": [45.47538956288615, 9.225206151463]}, {"serial": "119010137", "coords": [45.475586299999996, 9.2239964]}, {"serial": "219011713", "coords": [45.4761537, 9.2238819]}, {"serial": "119010133", "coords": [45.475771325512106, 9.223805763673113]}, {"serial": "4718009308", "coords": [45.481866909285145, 9.220368211887944]}, {"serial": "219011683", "coords": [45.481679992033825, 9.219389080105543]}, {"serial": "4718009304", "coords": [45.48148676382104, 9.221167172172953]}, {"serial": "4718009294", "coords": [45.48184592096532, 9.221166329976768]}, {"serial": "219011853", "coords": [45.4846652, 9.223621699999999]}, {"serial": "219011835", "coords": [45.4887217, 9.2261974]}, {"serial": "219011869", "coords": [45.4879076, 9.2280049]}, {"serial": "219011848", "coords": [45.488767700000004, 9.227943199999999]}, {"serial": -1, "coords": [45.5069182, 9.2684501]}]
L.tileLayer.provider('Hydda.Full')
var waypoints = []
var counter = 0

var url = new URL(location.href)
var step = url.searchParams.get("step")

if(step < pathObjects.length){
	/*window.setTimeout(function(){
		location.href = location.origin + location.hostname + location.pathname + "?step=" + (parseInt(step)+1)
	}, 5000)*/
}

for(var i = 0; i < pathObjects.length; i++){
	var coords = pathObjects[i].coords;
	waypoints.push(L.latLng(coords[0],coords[1]))
}

var control = L.Routing.control(L.extend(window.lrmConfig, {
	waypoints: waypoints/*[
		L.latLng(45.478015,9.207587),
		L.latLng(45.493683,9.207779),
		L.latLng(45.485590,9.209450)
	]*/,
	geocoder: L.Control.Geocoder.nominatim(),
	routeWhileDragging: true,
	reverseWaypoints: true,
	/*showAlternatives: true,*/
	altLineOptions: {
		styles: [
			{color: 'black', opacity: 0.15, weight: 9},
			{color: 'white', opacity: 0.8, weight: 6},
			{color: 'blue', opacity: 0.5, weight: 2}
		]
	},
	serviceUrl: 'http://localhost:5000/route/v1'
})).addTo(map);

L.Routing.errorControl(control).addTo(map);